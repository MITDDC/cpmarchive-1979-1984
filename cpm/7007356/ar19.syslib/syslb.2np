                        SYSLIB User and Reference Manual



        17.0 ZCPR2 Feature-Specific Routines

             This module contains a series of routines which are designed 
        to  allow the programmer to take advantage of key ZCPR2  Features 
        without doing a lot of programming for himself.   In  particular, 
        facilities such as the following are provided:

                  .  Initialization -- Setting the location of the
                            multiple command line buffer
                  .  Initialization -- Defining the location of a command
                            search path
                  .  Initialization -- Setting the current disk/user
                            character definition
                  .  Initialization -- Setting all ZCPR2 buffers as
                            required from buffers set up as per the
                            ZCPR2 Utility Standard General Purpose
                            Installation Format
                  .  Utility -- Returning a pointer to the first byte
                            of the next command
                  .  Utility -- Searching for a file along the command
                            search path
                  .  Utility -- Determining the attributes of a file

                  


             Routine Name:  ZINIMC
             Function:
                  ZINIMC defines the base address of the multiple command 
        line  buffer for the ZCPR2 system.   The initialization performed 
        by  this  routine  is used by the ZMCPTR routine  to  return  the 
        pointer to the first character of the next command.

             Inputs:  HL = base address of multiple command line buffer

             Outputs:  None

             Registers Affected:  None

             SYSLIB Routines Called:  None

             Special  Error Conditions:  None

             Note:   If  this routine is not called,  it is assumed  that 
        multiple command lines are not supported.











        17 - ZCPR2 Feature-Specific Routines                   Page 58





                        SYSLIB User and Reference Manual



             Routine Name:  ZINIEXT
             Function:
                  ZINIEXT  defines the base address of a  command  search 
        path.   The  ZPFIND  routine uses this base address to start  its 
        search for a file.   Note that this provides added flexibility in 
        that  this need not necessarily be the base address of the  ZCPR2 
        System command search path, but it may be the base address of any 
        path (such as a separate path to look for HLP files).

             Inputs:  HL = base address of path

             Outputs:  None

             Registers Affected:  None

             SYSLIB Routines Called:  None

             Special  Error Conditions:  None

             Note:   If  this  routine is not called,  the external  path 
        defaults to an empty path,  so no harm is done and no search  can 
        be performed.





             Routine Name:  ZCPRSET
             Function:
                  ZCPRSET  performs  two  functions  -- it  defines   the 
        character used to specify the current disk or user (default value 
        is  $) and it sets the DMA address for disk file transfers  (used 
        by  ZFSTAT).   If  this routine is not called,  then the  current 
        indicator is defaulted to $ and the DMA address is set to 80H.

             Inputs:  A = Current Indicator, HL = DMA Address

             Outputs:  None

             Registers Affected:  None

             SYSLIB Routines Called:  None

             Special  Error Conditions:  None

             Note:   If  this  routine is not called,  Current  Indicator 
        defaults to $ and DMA Address defaults to 80H.









        17 - ZCPR2 Feature-Specific Routines                   Page 59





                        SYSLIB User and Reference Manual



             Routine Name:  ZGPINS
             Function:
                  ZGPINS  initializes the ZCPR2-Specific Buffers from the 
        ZCPR2  Utility Standard General-Purpose Installation Format  Buf-
        fers.   This is to be used by ZCPR2 Utilities,  such as XDIR3, to 
        completely initialize all the necessary buffers.
             The buffers in the utilities are located as indicated in the 
        ZCPR2 Utilities Manual.

             Inputs:  None

             Outputs:  None

             Registers Affected:  None

             SYSLIB Routines Called:  MOVEB, ZINIMC, ZINIEXT, ZCPRSET,
                                      ZFNINIT

             Special  Error Conditions:  None





             Routine Name:  ZCPRQ
             Function:
                  ZCPRQ  queries  the status of the SZCPR  module,  which 
        contains these routines.  On exit, this routine returns:
                       Base Address of External Path
                       Base Address of Multiple Command Buffer
                       Multiple Command Available Flag (0=No)

             Inputs:  None

             Outputs:  HL = Base Address of External Path
                       DE = Base Address of Multiple Command Buffer
                       A = Multiple Command Available Flag (0=No)

             Registers Affected:  HL, DE, A

             SYSLIB Routines Called:  None

             Special  Error Conditions:  None













        17 - ZCPR2 Feature-Specific Routines                   Page 60





                        SYSLIB User and Reference Manual



             Routine Name:  ZMCPTR
             Function:
                  ZMCPTR  returns a pointer to the next character in  the 
        multiple command line if multiple commands are enabled.   A  flag 
        is returned which says if multiple commands are enabled or not.

             Inputs:  None

             Outputs:  HL pts to next char in line
                       A=0 and Zero Flag Set (Z) if multiple commands
                            are not available; NZ otherwise

             Registers Affected:  HL, PSW

             SYSLIB Routines Called:  None

             Special  Error Conditions:  None




             Routine Name:  ZPFIND
             Function:
                  ZPFIND  searches  for a file along the  command  search 
        path  whose  base address was defined when the programmer  called 
        ZINIEXT.   It  logs into each disk and user area along the  path, 
        looking for the file whose FCB is pted to by DE,  until it either 
        finds  the file or reaches the end of the path (file not  found).  
        If the file is found,  it returns the disk and user area in which 
        the file resides.   ZPFIND always returns the process to the disk 
        and user area it is "currently" logged into.

             Inputs:  DE pts to the FCB of the file to find
                      B is a flag; if B <> 0, search the current disk and
                            user area first; if B=0, do not search the
                            current disk and user area first

             Outputs:  Zero Flag Clear (NZ) and A=0FFH if file found
                       B = Disk (B=0 if Disk A), C=User if file found
                       Zero Flag Set (Z) and A=0 if file not found

             Registers Affected:  BC, PSW

             SYSLIB Routines Called:  BDOS

             Special  Error Conditions:  None










        17 - ZCPR2 Feature-Specific Routines                   Page 61





                        SYSLIB User and Reference Manual



             Routine Name:  ZFSTAT
             Function:
                  ZFSTAT  determines  the attributes of the file  in  the 
        current disk and user area whose FCB is pted to by DE.   It tells 
        the programmer if the file is SYSTEM or not and READ/ONLY or not.

             Inputs:  DE pts to FCB of file

             Outputs:  B=0 means file is NOT System, B<>0 means file is
                       C=0 means file is NOT R/O, C<>0 means file is
                       Zero Flag Set (Z) and A=0 if file found and BC
                            valid, and Zero Flag Clear (NZ) if file not
                            found

             Registers Affected:  BC, PSW

             SYSLIB Routines Called:  BDOS

             Special  Error Conditions:  None

             Note:  ZFSTAT does NOT do a search.



































        17 - ZCPR2 Feature-Specific Routines                   Page 62





                        SYSLIB User and Reference Manual



        18.0 ZCPR2-Specific Named Directory Routines

             This set of routines is specific to the ZCPR2-Specific Named 
        Directory Structure.   These routines provide the programmer with 
        a  set  of routines which resolve the named directory  references 
        for him, translating a named directory into the disk/user area it 
        refers to.

             Four routines are included in this set:
                  o ZFNINIT -- Initialize Named Directory Buffers
                  o ZDNFIND -- Scan for Disk Directory Name
                  o ZDNAME -- Load All Disk Directory Name Data
                  o ZFNAME -- Named Directory File Name Scanner




             Routine Name:  ZFNINIT
             Function:
                  ZFNINIT  allows the user to initialize the name of  the 
        named  directory  file (default name of NAMES.DIR) to some  other 
        name  and to change the number of names permitted in a  directory 
        file (default of 64).

             Inputs:  DE pts to FCB containing the new file name
                      C is the new maximum number of directory names
                      A is a flag indicating values to set as follows:
                            Bit 7 -- Set to 1 to load default FCB fm DE
                            Bit 6 -- Set to 1 to load name count fm C

             Outputs:  None

             Registers Affected:  None

             SYSLIB Routines Called:  MOVEB

             Special  Error Conditions:  None



















        18 - ZCPR2-Specific Named Directory Routines           Page 63





                        SYSLIB User and Reference Manual



             Routine Name:  ZDNAME
             Function:
                  ZDNAME  loads the contents of the NAMES.DIR  file  into 
        the memory buffer pointed to by HL.  Each entry in this buffer is 
        structured as follows:
                       Byte 0:  Disk Number (A=0)
                       Byte 1:  User Number
                       Bytes 2-9:  Directory Name, 8 Chars Max, Space
                            Fill at End

             Inputs:  HL pts to the memory buffer extending to the base
                       of the BDOS

             Outputs:  HL pts to the first entry in the buffer
                       C is the number of valid entries, B=0
                       A is the error flag (A=0 and Z if error)

             Registers Affected:  HL, BC, PSW

             SYSLIB Routines Called:  INITFCB, ZPFIND, FI3$OPEN, F3$GET

             Special Error Conditions:  None





             Routine Name:  ZDNFIND
             Function:
                  ZDNFIND examines the DIR:  prefix for either a DU: form 
        or a directory name.  If it is determined that the DIR: prefix is 
        not of the DU:  form, then the NAMES.DIR file is sought along the 
        ZCPR2  path,  loaded,  and scanned for a corresponding name.   If 
        found,  the corresponding user and disk values are  returned;  if 
        not found, an error code is returned.

             Inputs:  HL pts to first byte of DIR: prefix
                      A=0 if DU: form NOT allowed

             Outputs:  B=Disk (B=1 if Disk A, B=0FFH if Current Disk),
                       C=User (C=0FFH if Current User), HL pts to colon,
                       Zero Flag Clear (NZ) if no error; Zero Flag Set 
                       (Z) if error, and no valid values returned

             Registers Affected:  BC, HL, PSW

             SYSLIB Routines Called:  INITFCB, ZPFIND, FI3$OPEN,
                                      FI3$CLOSE, F3$GET

             Special Error Conditions:  Note that ZDNFIND uses Input File 
        3,  so  Input  File 3 should not be opened when this  routine  is 
        called.   Also,  ZPFIND is used, so the programmer must be sure a 
        proper external path is specified if needed by calling ZINIEXT.



        18 - ZCPR2-Specific Named Directory Routines           Page 64





                        SYSLIB User and Reference Manual



             Routine Name:  ZFNAME
             Function:
                  ZFNAME  is a file name scanner.   Pointing to the first 
        character   of   a   file  name   specification   of   the   form 
        'DIR:FILENAME.TYP',  where  any  part  of this  specification  is 
        optional,  this  routine fills in an FCB  with  zeroes,  properly 
        initializes  the  FN and FT (File Name and File Type)  fields  if 
        'FILENAME.TYP'  or any part thereof is present,  and returns  the 
        value of disk and user if they are specified (or 0FFH if not).
             The directory indicator 'DIR:',  if specified, may be of one 
        of four forms:
                  DIRECT: -- A named directory, of up to 8 chars long
                  d:      -- A disk drive letter
                  u:      -- A user number
                  du:     -- A disk drive letter and a user number
             The du:  form is checked first, so unnecessary disk activity 
        in looking for the NAMES.DIR file is avoided.
             Examples of valid input strings:
                  HELP:*.HLP     A5:TEST.TXT    C?:ABC.*  PASCAL:*.COM

             Inputs:  DE pts to FCB to fill, HL pts to first byte of
                       target string; FCB is 36 bytes long

             Outputs:  B=Disk (B=1 for Disk A), C=User
                       B=0FFH if no disk specified (current disk)
                       C=0FFH if no user specified (current user)
                       C=? if all user areas specified
                       HL pts to terminating character
                       A=0 and Zero Flag Set (Z) if error in disk
                            or user numbers; A=0FFH and NZ if no error

             Registers Affected:  BC, HL, PSW

             SYSLIB Routines Called:  ZDNFIND

             Special   Error   Conditions:    See   FNAME   routine   for 
        similarities



















        18 - ZCPR2-Specific Named Directory Routines           Page 65





                        SYSLIB User and Reference Manual



        19.0 Miscellaneous Routines 

             This section describes the following Miscellaneous Routines:


                  BDOS      For Direct BDOS Interface
                  BIOS      For Direct BIOS Interface
                  CAPS      For Character Capitalization
                  CAPSTR    For String Capitalization
                  CATH      Convert ASCII Character to Hexadecimal
                  CODEND    Provide End of Code/Data Area
                  EN        Exchange Nybbles in A
                  FILLB     Fill Memory (up to 255 bytes)
                   FILLBC   Fill Memory (up to 65,535 bytes)
                   HFILB    Fill Memory (up to 255 bytes)
                   HFILBC   Fill Memory (up to 65,535 bytes)
                  MOVEB     Move Memory (up to 255 bytes)
                   MOVEBC   Move Memory (up to 65,535 bytes)
                   HMOVB    Move Memory (up to 255 bytes)
                   HMOVBC   Move Memory (up to 65,535 bytes)
                  PAUSE     Delay N 10ths of a Second
                  VERSION   Return Version Number of SYSLIB


































        19 - Miscellaneous Routines                            Page 66





